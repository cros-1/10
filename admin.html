<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="bg-waves"><div class="wave w1"></div><div class="wave w2"></div><div class="wave w3"></div></div>
  <div class="topbar">
    <div class="hero"><div class="brand3d">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div></div>
    <div class="top-actions"><a href="index.html">Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</a></div>
  </div>
  <main class="wrap">
    <div class="card" id="gate">
      <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
      <div class="row"><input id="email" class="inp" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯"><input id="pwd" class="inp" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><button id="loginBtn" class="btn">Ø¯Ø®ÙˆÙ„</button></div>
      <div id="msg" class="note"></div>
    </div>

    <div id="panel" class="hidden">
      <div class="card">
        <h3>Ø§Ù„Ø«ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø®Ø· (Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±ÙŠØ©)</h3>
        <div class="row">
          <button id="toggleMode" class="modeBtn">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø·</button>
          <select id="themePick" class="inp" style="max-width:260px"></select>
          <label class="lbl-small">Ø£Ø³Ø§Ø³ÙŠ</label><input id="primary" type="color" class="inp" value="#1f3bff" style="max-width:120px">
          <label class="lbl-small">Ù…Ø³Ø§Ø¹Ø¯</label><input id="accent" type="color" class="inp" value="#a7b8ff" style="max-width:120px">
          <label class="lbl-small">Ø§Ù„Ø®Ø·</label>
          <select id="fontPick" class="inp" style="max-width:260px">
            <option>Tajawal</option><option>Cairo</option><option>El Messiri</option><option>Changa</option><option>Harmattan</option>
            <option>IBM Plex Sans Arabic</option><option>Almarai</option><option>Amiri</option><option>Baloo Bhaijaan 2</option><option>Reem Kufi</option>
            <option>Markazi Text</option><option>Mada</option><option>Lalezar</option><option>Scheherazade New</option><option>Vazirmatn</option>
            <option>Noto Kufi Arabic</option><option>Noto Naskh Arabic</option><option>Readex Pro</option><option>Katibeh</option><option>Mirza</option>
          </select>
          <button id="saveTheme" class="btn">Ø­ÙØ¸ Ø§Ù„Ø«ÙŠÙ…</button>
          <button id="resetTheme" class="btn">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
          <button id="exportBtn" class="btn">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          <input id="importFile" type="file" accept="application/json" class="inp" style="max-width:280px">
          <button id="importBtn" class="btn">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        </div>
      </div>

      <!-- Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø´Ø±Ù -->
      <div class="card">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø´Ø±Ù (Ù…Ø¹Ø§ÙŠÙ†Ø©) â€” Ø£Ù†Ù…Ø§Ø· Ø¨Ø§Ù†ÙˆØ±Ø§Ù…ÙŠØ©/Ø´Ø¨ÙƒÙŠØ©/Ø²Ø¬Ø§Ø¬ÙŠØ©/Ù†ÙŠÙˆÙ†</h3>
        <div class="row">
          <input id="hId" class="inp" placeholder="(ØªØ­Ø±ÙŠØ±) Ø§Ù„Ù…Ø¹Ø±Ù‘Ù" disabled>
          <input id="hCat" class="inp" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø£ÙØ¶Ù„ ÙØ±Ù‚Ø© / Ø£ÙØ¶Ù„ Ø²Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© ...)">
          <input id="hCenter" class="inp" placeholder="Ø§Ù„Ù…Ø±ÙƒØ² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
          <select id="hIcon" class="inp">
            <option value="crown">ØªØ§Ø¬</option><option value="shield">Ø¯Ø±Ø¹</option><option value="medal">Ù…ÙŠØ¯Ø§Ù„ÙŠØ©</option><option value="star">Ù†Ø¬Ù…Ø©</option>
            <option value="diamond">Ù…Ø§Ø³Ø©</option><option value="trophy">ÙƒØ£Ø³</option><option value="cup">Cup</option><option value="laurel">ØºØ§Ø±</option><option value="shieldStar">Ø¯Ø±Ø¹ Ù†Ø¬Ù…ÙŠ</option>
          </select>
          <select id="hStyle" class="inp">
            <option>royal</option><option>gold</option><option>silver</option><option>platinum</option><option>obsidian</option>
            <option>panorama</option><option>mesh</option><option>glass</option><option>neon</option>
          </select>
        </div>
        <div class="row">
          <input id="hTitle" class="inp" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰ (Ù…Ø«Ø§Ù„: ÙØ±Ù‚Ø© Ø§Ù„ØµÙ‚ÙˆØ±)">
          <textarea id="hMembers" class="inp" rows="4" placeholder="Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (ÙƒÙ„ Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø±)"></textarea>
        </div>
        <div class="row">
          <input id="hImg" type="file" class="inp" accept="image/*">
          <button id="previewHonor" class="btn">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
          <button id="saveHonor" class="btn">Ø­ÙØ¸ Ø§Ù„Ù„ÙˆØ­Ø©</button>
          <button id="clearHonor" class="btn">ØªÙØ±ÙŠØº</button>
        </div>
        <div id="honorPreview" class="card hidden"></div>
        <div id="honorList" class="note"></div>
      </div>

      <!-- Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
      <div class="card">
        <h3>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
        <div class="row">
          <input id="adId" class="inp" placeholder="(ØªØ­Ø±ÙŠØ±) Ø§Ù„Ù…Ø¹Ø±Ù‘Ù)" disabled>
          <input id="adTitle" class="inp" placeholder="Ø¹Ù†ÙˆØ§Ù†">
          <input id="adText" class="inp" placeholder="Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
          <button id="saveAd" class="btn">Ø­ÙØ¸ / Ù†Ø´Ø±</button>
        </div>
        <div id="adsList" class="note"></div>
      </div>

      <!-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="card">
        <h3>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
        <div class="row">
          <input id="lId" class="inp" placeholder="(ØªØ­Ø±ÙŠØ±) Ø§Ù„Ù…Ø¹Ø±Ù‘Ù" disabled>
          <input id="lName" class="inp" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø±">
          <input id="lUrl" class="inp" placeholder="https:// Ø§Ù„Ø±Ø§Ø¨Ø·">
          <select id="lIcon" class="inp" style="max-width:180px">
            <option value="sheet">ğŸ“Š Sheet</option><option value="form">ğŸ“ Form</option><option value="swap">ğŸ” Swap</option>
            <option value="check">âœ… Check</option><option value="ideas">ğŸ’¡ Ideas</option><option value="ads">ğŸ“¢ Ads</option>
            <option value="people">ğŸ‘¥ People</option><option value="gear">âš™ï¸ Gear</option><option value="time">â±ï¸ Time</option>
            <option value="doc">ğŸ“„ Doc</option><option value="star">â­ Star</option><option value="shield">ğŸ›¡ï¸ Shield</option>
            <option value="crown">ğŸ‘‘ Crown</option><option value="mail">âœ‰ï¸ Mail</option><option value="chart">ğŸ“ˆ Chart</option>
            <option value="bell">ğŸ”” Bell</option><option value="target">ğŸ¯ Target</option><option value="folder">ğŸ—‚ï¸ Folder</option>
            <option value="clip">ğŸ”— Link</option><option value="home">ğŸ  Home</option><option value="plane">âœˆï¸ Plane</option>
            <option value="hospital">ğŸ¥ Hospital</option><option value="car">ğŸš“ Patrol</option>
          </select>
          <input id="lOrder" class="inp" type="number" min="1" value="1" style="max-width:120px" placeholder="Ø§Ù„ØªØ±ØªÙŠØ¨">
          <button id="saveLink" class="btn">Ø­ÙØ¸</button>
        </div>
        <div id="linksList" class="note"></div>
      </div>
    </div>
  </main>
  <footer class="footer">Ù…Ù†ØµØ© Ù‚Ø·Ø§Ø¹ Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, push, set, update, remove, get, child, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getStorage, ref as sref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { firebaseConfig } from "./firebase-config.js";
    import { THEMES, applyTheme } from "./themes.js";
    import { iconSVG } from "./icons.js";

    const app=initializeApp(firebaseConfig); const auth=getAuth(app); const db=getDatabase(app); const st=getStorage(app);
    const $=s=>document.querySelector(s);
    const out=(m,ok=true)=>{const el=$('#msg'); el.textContent=m; el.style.color=ok?'var(--muted)':'#ff6b6b'};
    const now=()=>new Date().toISOString().slice(0,16).replace('T',' ');
    const qAll=p=>get(child(ref(db),p)).then(s=>s.exists()?s.val():null).catch(_=>null);

    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø«ÙŠÙ… Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    onValue(ref(db,'settings/theme'), s=>{
      if(!s.exists())return;
      const v=s.val();
      document.documentElement.dataset.theme = v.mode||localStorage.getItem('themeMode')||'dark';
      document.documentElement.style.setProperty('--font', `'${v.font||'Tajawal'}', system-ui, Arial`);
      document.documentElement.style.setProperty('--primary', v.primary||'#1f3bff');
      document.documentElement.style.setProperty('--accent', v.accent||'#a7b8ff');
      $('#primary').value=v.primary||'#1f3bff'; $('#accent').value=v.accent||'#a7b8ff';
      // Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±ÙŠØ©
      applyTheme({primary:v.primary||'#1f3bff',accent:v.accent||'#a7b8ff',bg:'#0a1024'});
    });

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø· Ù…Ø­Ù„ÙŠÙ‹Ø§
    $('#toggleMode').onclick=()=>{ const cur = document.documentElement.dataset.theme==='light'?'dark':'light'; document.documentElement.dataset.theme=cur; localStorage.setItem('themeMode',cur); };

    // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª
    const tp=$('#themePick'); THEMES.forEach((t,i)=>{const o=document.createElement('option'); o.value=i; o.textContent=t.name; tp.appendChild(o)});

    // Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹/ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯
    $('#saveTheme').onclick=async()=>{
      const pick=THEMES[tp.value]||THEMES[0];
      const font = $('#fontPick').value || 'Tajawal';
      const payload={
        mode:document.documentElement.dataset.theme||'dark',
        primary:$('#primary').value||pick.primary,
        accent:$('#accent').value||pick.accent,
        font:font
      };
      await set(ref(db,'settings/theme'),payload);
      document.documentElement.style.setProperty('--font', `'${font}', system-ui, Arial`);
      applyTheme({primary:payload.primary,accent:payload.accent,bg:'#0a1024'});
      out('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø«ÙŠÙ…');
    };
    $('#resetTheme').onclick=async()=>{
      const payload={mode:'dark',primary:'#1f3bff',accent:'#a7b8ff',font:'Tajawal'};
      await set(ref(db,'settings/theme'),payload);
      localStorage.setItem('themeMode','dark');
      document.documentElement.dataset.theme='dark';
      document.documentElement.style.setProperty('--font', `'Tajawal', system-ui, Arial`);
      applyTheme({primary:'#1f3bff',accent:'#a7b8ff',bg:'#0a1024'});
      out('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
    };
    $('#exportBtn').onclick=async()=>{
      const data={
        settings: await qAll('settings')||{},
        links: await qAll('links')||{},
        ads: await qAll('ads')||{},
        honor: await qAll('honor')||{}
      };
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='portal-backup.json'; a.click(); URL.revokeObjectURL(a.href);
      out('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    };
    $('#importBtn').onclick=async()=>{
      const f=$('#importFile').files[0]; if(!f) return out('Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§',false);
      const txt=await f.text(); let data={}; try{data=JSON.parse(txt)}catch(e){return out('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­',false)}
      if(data.settings) await set(ref(db,'settings'),data.settings);
      if(data.links) await set(ref(db,'links'),data.links);
      if(data.ads) await set(ref(db,'ads'),data.ads);
      if(data.honor) await set(ref(db,'honor'),data.honor);
      out('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');
    };

    // Ø¯Ø®ÙˆÙ„
    $('#loginBtn').onclick=async()=>{try{await signInWithEmailAndPassword(auth,$('#email').value.trim(),$('#pwd').value.trim())}catch(e){out('ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: '+e.message,false)}};
    onAuthStateChanged(auth, user=>{ if(user){$('#gate').classList.add('hidden');$('#panel').classList.remove('hidden');refreshAll()} else{$('#panel').classList.add('hidden');$('#gate').classList.remove('hidden')} });

    // Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø´Ø±Ù
    function honorHTML(h){
      const map={'royal':'honor honor--royal glow','gold':'honor honor--gold glow','silver':'honor honor--silver glow','platinum':'honor honor--platinum glow','obsidian':'honor honor--obsidian glow','panorama':'honor honor--panorama glow','mesh':'honor honor--mesh glow','glass':'honor honor--glass glow','neon':'honor honor--neon glow'};
      const cls=map[h.style||'royal']||map.royal;
      const img = h.imgURL ? `<img src="${h.imgURL}" style="width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid #ffffff22">` : '';
      return `<div class="${cls}"><div class="sheen"></div>` +
        (h.iconName?`${iconSVG(h.iconName)}`:'') + img +
        `<div class="h-title">${h.title||''}</div><div class="h-meta">${h.category||''}${h.center?(' â€¢ Ø§Ù„Ù…Ø±ÙƒØ²: '+h.center):''}</div>
        <div class="h-names">${(h.members||'').replaceAll('\n','<br>')}</div></div>`;
    }
    $('#previewHonor').onclick=()=>{
      const payload={category:$('#hCat').value.trim(), center:$('#hCenter').value.trim(), iconName:$('#hIcon').value, style:$('#hStyle').value, title:$('#hTitle').value.trim(), members:$('#hMembers').value.trim()};
      const box=$('#honorPreview'); box.classList.remove('hidden'); box.innerHTML=honorHTML(payload);
    };
    async function refreshHonor(){
      const data=await qAll('honor')||{}; const list=Object.entries(data).map(([id,v])=>({id,...v})).sort((a,b)=>(b.date||'').localeCompare(a.date||''));
      $('#honorList').innerHTML=list.map(it=>`<div class="card">
        <div><b>${it.title||''}</b> â€” ${it.category||''} ${it.center?(' â€” Ø§Ù„Ù…Ø±ÙƒØ²: '+it.center):''}</div>
        ${it.imgURL?`<img src="${it.imgURL}" style="width:64px;height:64px;border-radius:10px;border:1px solid #ffffff22;object-fit:cover">`:''}
        <div class="note" style="white-space:pre-line">${it.members||''}</div>
        <div class="row"><button class="btn" data-edit="${it.id}">ØªØ¹Ø¯ÙŠÙ„</button><button class="btn" data-del="${it.id}">Ø­Ø°Ù</button></div>
      </div>`).join('');
      document.querySelectorAll('[data-edit]').forEach(b=>b.onclick=()=>{
        const it=list.find(x=>x.id===b.dataset.edit);
        hId.value=it.id; hCat.value=it.category||''; hCenter.value=it.center||'';
        hIcon.value=it.iconName||'trophy'; hStyle.value=it.style||'royal';
        hTitle.value=it.title||''; hMembers.value=it.members||'';
      });
      document.querySelectorAll('[data-del]').forEach(b=>b.onclick=async()=>{if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ'))return; await remove(ref(db,'honor/'+b.dataset.del)); out('ØªÙ… Ø§Ù„Ø­Ø°Ù'); refreshHonor()});
    }
    $('#clearHonor').onclick=()=>{$('#hId').value=$('#hCat').value=$('#hCenter').value=$('#hTitle').value=$('#hMembers').value=''; $('#hImg').value=''; $('#honorPreview').classList.add('hidden')};
    $('#saveHonor').onclick=async()=>{
      const id=($('#hId').value||'').trim();
      const payload={category:$('#hCat').value.trim(),center:$('#hCenter').value.trim(),iconName:$('#hIcon').value,style:$('#hStyle').value,title:$('#hTitle').value.trim(),members:$('#hMembers').value.trim(),date:now()};
      const f=$('#hImg').files[0];
      if(f){const upRef=sref(st,'honors/'+Date.now()+'_'+f.name); await uploadBytes(upRef,f); payload.imgURL=await getDownloadURL(upRef);}
      if(!payload.category||!payload.title) return out('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø³Ù…Ù‘Ù‰',false);
      if(id) await update(ref(db,'honor/'+id),payload); else await set(push(ref(db,'honor')),payload);
      out('ØªÙ… Ø§Ù„Ø­ÙØ¸'); refreshHonor(); $('#clearHonor').click();
    };

    // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
    async function refreshAds(){
      const data=await qAll('ads')||{}; const list=Object.entries(data).map(([id,v])=>({id,...v})).sort((a,b)=>(b.date||'').localeCompare(a.date||''));
      $('#adsList').innerHTML=list.map(it=>`<div class="card">
        <div><b>${it.title||''}</b></div><div class="note">${it.desc||''}</div>
        <div class="row"><button class="btn" data-ae="${it.id}">ØªØ¹Ø¯ÙŠÙ„</button><button class="btn" data-ad="${it.id}">Ø­Ø°Ù</button></div>
      </div>`).join('');
      document.querySelectorAll('[data-ae]').forEach(b=>b.onclick=()=>{
        const it=list.find(x=>x.id===b.dataset.ae);
        adId.value=it.id; adTitle.value=it.title||''; adText.value=it.desc||'';
      });
      document.querySelectorAll('[data-ad]').forEach(b=>b.onclick=async()=>{
        if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ'))return; await remove(ref(db,'ads/'+b.dataset.ad)); out('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†'); refreshAds()
      });
    }
    $('#saveAd').onclick=async()=>{
      const id=($('#adId').value||'').trim();
      const payload={title:$('#adTitle').value.trim(),desc:$('#adText').value.trim(),date:now()};
      if(!payload.title||!payload.desc) return out('Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ†Øµ',false);
      if(id) await update(ref(db,'ads/'+id),payload); else await set(push(ref(db,'ads')),payload);
      out('ØªÙ… Ø§Ù„Ø­ÙØ¸'); refreshAds(); $('#adId').value=$('#adTitle').value=$('#adText').value='';
    };

    // Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    async function refreshLinks(){
      const data=await qAll('links')||{}; const list=Object.entries(data).map(([id,v])=>({id,...v})).sort((a,b)=>(a.order||999)-(b.order||999));
      $('#linksList').innerHTML=list.map(it=>`<div class="card">
        <div><b>${it.name||''}</b> â€” <span class="note">${it.url||''}</span> â€” <span>${it.icon?(''+it.icon):''}</span> â€” ØªØ±ØªÙŠØ¨: ${it.order||''}</div>
        <div class="row"><button class="btn" data-le="${it.id}">ØªØ¹Ø¯ÙŠÙ„</button><button class="btn" data-ld="${it.id}">Ø­Ø°Ù</button></div>
      </div>`).join('');
      document.querySelectorAll('[data-le]').forEach(b=>b.onclick=()=>{
        const it=list.find(x=>x.id===b.dataset.le);
        lId.value=it.id; lName.value=it.name||''; lUrl.value=it.url||''; lIcon.value=it.icon||'link'; lOrder.value=it.order||1;
      });
      document.querySelectorAll('[data-ld]').forEach(b=>b.onclick=async()=>{
        if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ'))return; await remove(ref(db,'links/'+b.dataset.ld)); out('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·'); refreshLinks()
      });
    }
    $('#saveLink').onclick=async()=>{
      const id=($('#lId').value||'').trim();
      const payload={name:$('#lName').value.trim(),url:$('#lUrl').value.trim(),icon:$('#lIcon').value,order:Number($('#lOrder').value)||1,date:now()};
      if(!payload.name||!payload.url) return out('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø·',false);
      if(id) await update(ref(db,'links/'+id),payload); else await set(push(ref(db,'links')),payload);
      out('ØªÙ… Ø§Ù„Ø­ÙØ¸'); refreshLinks(); $('#lId').value=$('#lName').value=$('#lUrl').value=''; $('#lOrder').value='1';
    };

    async function refreshAll(){ await Promise.all([refreshHonor(),refreshAds(),refreshLinks()]); }
  </script>
</body>
</html>
